Upload Flow->

┌─────────────────┐    ┌──────────────────┐    ┌─────────────┐    ┌──────────────────┐
│   Optimizely    │    │  GcpBlobProvider │    │   GcpBlob   │    │ Google Cloud     │
│     CMS 12      │    │                  │    │             │    │    Storage       │
└─────────────────┘    └──────────────────┘    └─────────────┘    └──────────────────┘
         │                        │                      │                    │
         │ 1. User uploads file   │                      │                    │
         │                        │                      │                    │
         │ 2. CreateBlob()        │                      │                    │
         │──────────────────────> │                      │                    │
         │                        │                      │                    │
         │                        │ 3. GetBlob()         │                    │
         │                        │────────────────────> │                    │
         │                        │                      │                    │
         │                        │ 4. Returns GcpBlob   │                    │
         │                        │<──────────────────── │                    │
         │                        │                      │                    │
         │ 5. OpenWrite()         │                      │                    │
         │──────────────────────────────────────────────>│                    │
         │                        │                      │                    │
         │ 6. Returns WriteStream │                      │                    │
         │<──────────────────────────────────────────────│                    │
         │                        │                      │                    │
         │ 7. Write file data     │                      │                    │
         │──────────────────────────────────────────────>│                    │
         │                        │                      │                    │
         │ 8. Close stream        │                      │                    │
         │──────────────────────────────────────────────>│                    │
         │                        │                      │                    │
         │                        │                      │ 9. Upload to GCP   │
         │                        │                      │──────────────────> │
         │                        │                      │                    │
         │                        │                      │ 10. Upload success │
         │                        │                      │<────────────────── │
         │                        │                      │                    │


 ┌────────────────────────────┐
 │   File Upload in CMS UI    │
 └─────────────┬──────────────┘
               │ HTTP POST
               ▼
    ┌────────────────────────────┐
    │ GcpBlobProvider.CreateBlob │
    └─────────────┬──────────────┘
                  │
                  ▼
       ┌──────────────────────┐
       │   Return GcpBlob     │
       └──────────┬───────────┘
                  │
                  ▼
    ┌────────────────────────────┐
    │ GcpBlob.OpenWrite()        │
    │ → returns GcpBlobWriteStream│
    └─────────────┬──────────────┘
                  │
                  ▼
     ┌──────────────────────────┐
     │ CMS writes bytes to      │
     │ GcpBlobWriteStream       │
     └─────────────┬────────────┘
                   │
                   ▼
    ┌────────────────────────────┐
    │ Stream Close triggers      │
    │ Upload to GCS via API      │
    └─────────────┬──────────────┘
                  │
                  ▼
     ┌─────────────────────────┐
     │ CMS stores blob URI in  │
     │ content database        │
     └─────────────────────────┘



Download Flow ->

┌─────────────────┐    ┌──────────────────┐    ┌─────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   User/Browser  │    │  Optimizely CMS  │    │   GcpBlob   │    │ Google Cloud     │    │ GcpBlobFileInfo │
│                 │    │  Media Handler   │    │             │    │    Storage       │    │                 │
└─────────────────┘    └──────────────────┘    └─────────────┘    └──────────────────┘    └─────────────────┘
         │                        │                      │                    │                        │
         │ 1. Request image       │                      │                    │                        │
         │──────────────────────> │                      │                    │                        │
         │                        │                      │                    │                        │
         │                        │ 2. GetBlob()         │                    │                        │
         │                        │────────────────────> │                    │                        │
         │                        │                      │                    │                        │
         │                        │ 3. AsFileInfoAsync() │                    │                        │
         │                        │────────────────────> │                    │                        │
         │                        │                      │                    │                        │
         │                        │                      │ 4. DownloadObjectAsync()                    │
         │                        │                      │──────────────────> │                        │
         │                        │                      │                    │                        │
         │                        │                      │ 5. File data       │                        │
         │                        │                      │<────────────────── │                        │
         │                        │                      │                    │                        │
         │                        │                      │ 6. Create GcpBlobFileInfo                   │
         │                        │                      │──────────────────────────────────────────>  │
         │                        │                      │                    │                        │
         │                        │ 7. Returns IFileInfo │                    │                        │
         │                        │<──────────────────── │──────────────────────────────────────────   │
         │                        │                      │                    │                        │
         │                        │ 8. OpenRead() or use │                    │                        │
         │                        │    IFileInfo stream  │                    │                        │
         │                        │────────────────────> │                    │                        │
         │                        │                      │                    │                        │
         │                        │ 9. Returns stream    │                    │                        │
         │                        │<──────────────────── │                    │                        │
         │                        │                      │                    │                        │
         │ 10. Serve file to user │                      │                    │                        │
         │<────────────────────── │                      │                    │                        │
         │                        │                      │                    │                        │



 ┌────────────────────────────┐
 │   CMS Media Request (UI)   │
 └─────────────┬──────────────┘
               │
               ▼
    ┌────────────────────────────┐
    │  GcpBlobProvider.GetBlob() │
    └─────────────┬──────────────┘
                  │
                  ▼
       ┌──────────────────────┐
       │  Create GcpBlob obj  │
       │  (bucket + object)   │
       └──────────┬───────────┘
                  │
                  ▼
    ┌────────────────────────────┐
    │  GcpBlob.OpenRead()        │
    │  - Calls GCS API           │
    │  - Downloads object stream │
    └─────────────┬──────────────┘
                  │
                  ▼
     ┌─────────────────────────┐
     │ CMS streams to browser  │
     │ or CMS editor preview   │
     └─────────────────────────┘
